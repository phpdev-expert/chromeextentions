{"ast":null,"code":"import _regeneratorRuntime from\"/home/dh/Desktop/react-chrome-secureshare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/dh/Desktop/react-chrome-secureshare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/dh/Desktop/react-chrome-secureshare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/home/dh/Desktop/react-chrome-secureshare/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject;import React,{useState,useEffect}from'react';import{Textarea,Flex,NumberInput,NumberInputField,NumberInputStepper,NumberIncrementStepper,NumberDecrementStepper,useBreakpointValue,Stack,Text,useDisclosure,Popover,PopoverTrigger,PopoverContent,PopoverHeader,PopoverBody,PopoverArrow,PopoverCloseButton,PopoverFooter,Button,useToast,Box,Heading,FormControl,FormLabel,FormHelperText}from'@chakra-ui/react';import{Formik,Form}from'formik';import CryptoJS from'crypto-js';import{gql}from'graphql-request';import{useMutation}from'react-query';import{nanoid}from'nanoid';import{endOfDay,startOfDay,subDays,format}from'date-fns';// import { format as zonedFormat, utcToZonedTime } from 'date-fns-tz';\nimport{DateRangePicker,DateRange}from'react-date-range';import ClipInput from'../components/ClipInput';import UploadFile from'../api/uploadfile';import{useAuth}from'../components/auth';import UploadBox from'../components/UploadBox';import{request}from'../api/graphql_api';var createShareMut=gql(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  mutation MyMutation(\\n    $accountId: String = \\\"\\\"\\n    $clickAllowed: Int = 10\\n    $endDate: String = \\\"\\\"\\n    $fileNames: [String]!\\n    $startDate: String = \\\"\\\"\\n    $encryptedData: String = \\\"\\\"\\n    $username: String = \\\"\\\"\\n  ) {\\n    v1_secureshare_SecureShare_Create(\\n      input: {\\n        accountId: $accountId\\n        clickAllowed: $clickAllowed\\n        endDate: $endDate\\n        fileNames: $fileNames\\n        startDate: $startDate\\n        encryptedData: $encryptedData\\n        username: $username\\n      }\\n    ) {\\n      files {\\n        name\\n        url\\n      }\\n      uuid\\n    }\\n  }\\n\"])));var SecureSharePage=function SecureSharePage(){var _useAuth=useAuth(),user=_useAuth.user;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),cliplink=_useState2[0],setCliplink=_useState2[1];var baseDate=new Date();var toast=useToast();var _useState3=useState([{startDate:startOfDay(subDays(baseDate,15)),endDate:endOfDay(baseDate),key:'selection'}]),_useState4=_slicedToArray(_useState3,2),range=_useState4[0],setRange=_useState4[1];var popM=useDisclosure();var _token='';function handleChangeToken(event){console.log(event.target.value);_token=event.target.value;}function setAuthToken(){localStorage.setItem('access-token',_token);window.location.reload();}var popsize=useBreakpointValue({base:null,lg:'auto'});var displayMobile=useBreakpointValue({base:true,lg:false});var displayDesktop=useBreakpointValue({base:false,lg:true});// const formatedData = graphData?.map((v) => {\n//   const datez = new Date(v.time);\n//   const timeZone = 'Europe/Berlin';\n//   const zonedDate = utcToZonedTime(datez, timeZone);\n//   return {\n//     count: v.count,\n//     time: zonedFormat(zonedDate, 'MM/dd/yyyy', {\n//       timeZone: 'UTC',\n//     }),\n//   };\n// });\nvar _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),genKey=_useState6[0],setgenKey=_useState6[1];useEffect(function(){setgenKey(nanoid());return function(){};},[]);var createShareMutation=useMutation(function(input){return request(createShareMut,input);});return/*#__PURE__*/React.createElement(Box,{flex:1},/*#__PURE__*/React.createElement(Box,{mb:10},/*#__PURE__*/React.createElement(Heading,{color:\"green.800\"},\"SecureShare\"),/*#__PURE__*/React.createElement(Text,{color:\"gray.700\"},\"Share your data securely\")),user?/*#__PURE__*/React.createElement(Formik,{enableReinitialize:true,initialValues:{data:'',files:[],clickAllowed:12},onSubmit:/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(values,_ref){var resetForm,_range$,_range$$endDate,_range$2,_range$2$startDate,_data$secureshare_Sec,_window,_window$location,_data$secureshare_Sec2,encrypted,filen,data,fileToUpload,_e$response,_e$response$errors$;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:resetForm=_ref.resetForm;_context2.prev=1;encrypted=CryptoJS.AES.encrypt(values.data,genKey).toString();filen=values.files.map(function(v){return v.name;});_context2.next=6;return createShareMutation.mutateAsync({accountId:user.accountId,clickAllowed:values.clickAllowed,endDate:(_range$=range[0])===null||_range$===void 0?void 0:(_range$$endDate=_range$.endDate)===null||_range$$endDate===void 0?void 0:_range$$endDate.toISOString(),startDate:(_range$2=range[0])===null||_range$2===void 0?void 0:(_range$2$startDate=_range$2.startDate)===null||_range$2$startDate===void 0?void 0:_range$2$startDate.toISOString(),username:user.username,encryptedData:encrypted,fileNames:filen});case 6:data=_context2.sent;fileToUpload=data===null||data===void 0?void 0:(_data$secureshare_Sec=data.secureshare_SecureShare_Create)===null||_data$secureshare_Sec===void 0?void 0:_data$secureshare_Sec.files;if(!fileToUpload){_context2.next=11;break;}_context2.next=11;return Promise.all(fileToUpload.map(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(f){var val;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:val=values.files.filter(function(v){return f.name===v.name;});_context.next=3;return UploadFile(f.url,val[0],null);case 3:case\"end\":return _context.stop();}}},_callee);}));return function(_x3){return _ref3.apply(this,arguments);};}()));case 11:setCliplink(\"http://\".concat((_window=window)===null||_window===void 0?void 0:(_window$location=_window.location)===null||_window$location===void 0?void 0:_window$location.host,\"/app/secure/\").concat(data===null||data===void 0?void 0:(_data$secureshare_Sec2=data.secureshare_SecureShare_Create)===null||_data$secureshare_Sec2===void 0?void 0:_data$secureshare_Sec2.uuid,\"/\").concat(genKey));toast({title:'File encrypted',description:'Files Added',status:'success',duration:3000,isClosable:true,position:'top'});_context2.next=21;break;case 15:_context2.prev=15;_context2.t0=_context2[\"catch\"](1);if(!_context2.t0.response){_context2.next=20;break;}toast({title:'Response Error',description:_context2.t0===null||_context2.t0===void 0?void 0:(_e$response=_context2.t0.response)===null||_e$response===void 0?void 0:(_e$response$errors$=_e$response.errors[0])===null||_e$response$errors$===void 0?void 0:_e$response$errors$.message,status:'error',duration:4000,isClosable:true,position:'top'});return _context2.abrupt(\"return\");case 20:toast({title:'Application Error',description:_context2.t0.message,status:'error',duration:4000,isClosable:true,position:'top'});case 21:case\"end\":return _context2.stop();}}},_callee2,null,[[1,15]]);}));return function(_x,_x2){return _ref2.apply(this,arguments);};}()},function(_ref4){var values=_ref4.values,isSubmitting=_ref4.isSubmitting,setFieldValue=_ref4.setFieldValue,handleChange=_ref4.handleChange;return/*#__PURE__*/React.createElement(Form,{style:{width:'100%'}},/*#__PURE__*/React.createElement(Heading,{size:\"md\",mb:4},\"Encrypt a message\"),/*#__PURE__*/React.createElement(Textarea,{required:true,name:\"data\",value:values.data,placeholder:\"Place a message to encrypt here\",onChange:handleChange}),/*#__PURE__*/React.createElement(Stack,{mt:4,flexDirection:{base:'column',md:'row'},justifyContent:\"space-between\"},/*#__PURE__*/React.createElement(FormControl,{maxWidth:300},/*#__PURE__*/React.createElement(FormLabel,null,\"Select Access Date Range\"),/*#__PURE__*/React.createElement(Stack,{spacing:2},/*#__PURE__*/React.createElement(Popover,{matchWidth:true,placement:\"bottom-end\",isOpen:popM.isOpen,onClose:popM.onClose},/*#__PURE__*/React.createElement(PopoverTrigger,null,/*#__PURE__*/React.createElement(Flex,{flexDirection:{base:'row',lg:'row'},tabIndex:\"0\",role:\"button\",\"aria-label\":\"Date Range\",p:2,borderWidth:2,borderRadius:\"lg\",onClick:popM.onOpen,variant:\"outline\"},/*#__PURE__*/React.createElement(Text,{mr:2,color:\"green.800\",fontWeight:\"bold\"},format(range[0].startDate,'MM/dd/yyyy')),/*#__PURE__*/React.createElement(Text,{mr:2},\"to\"),/*#__PURE__*/React.createElement(Text,{color:\"green.800\",fontWeight:\"bold\"},format(range[0].endDate,'MM/dd/yyyy')))),/*#__PURE__*/React.createElement(PopoverContent,{width:popsize},/*#__PURE__*/React.createElement(PopoverArrow,null),/*#__PURE__*/React.createElement(PopoverCloseButton,null),/*#__PURE__*/React.createElement(PopoverHeader,null,\"Date Range\"),/*#__PURE__*/React.createElement(PopoverBody,null,displayMobile&&/*#__PURE__*/React.createElement(DateRange,{editableDateInputs:true,onChange:function onChange(item){item.selection.startDate=startOfDay(item.selection.startDate);item.selection.endDate=endOfDay(item.selection.endDate);setRange([item.selection]);},moveRangeOnFirstSelection:false,ranges:range}),displayDesktop&&/*#__PURE__*/React.createElement(DateRangePicker,{editableDateInputs:true,onChange:function onChange(item){item.selection.startDate=startOfDay(item.selection.startDate);item.selection.endDate=endOfDay(item.selection.endDate);setRange([item.selection]);},showSelectionPreview:true,moveRangeOnFirstSelection:false,months:1,ranges:range,direction:\"horizontal\"})),/*#__PURE__*/React.createElement(PopoverFooter,{d:\"flex\",justifyContent:\"flex-end\"},/*#__PURE__*/React.createElement(Button,{colorScheme:\"blue\",onClick:function onClick(){popM.onClose();// analytics.refetch();\n}},\"Apply\"))))),/*#__PURE__*/React.createElement(FormHelperText,null,\"Choose when you want message to be accessed\")),/*#__PURE__*/React.createElement(FormControl,{maxWidth:300,ml:\"auto\"},/*#__PURE__*/React.createElement(FormLabel,{htmlFor:\"email\"},\"Allowed Opens\"),/*#__PURE__*/React.createElement(NumberInput,{min:1,required:true,onChange:function onChange(s,n){setFieldValue('clickAllowed',n);},value:values.clickAllowed},/*#__PURE__*/React.createElement(NumberInputField,null),/*#__PURE__*/React.createElement(NumberInputStepper,null,/*#__PURE__*/React.createElement(NumberIncrementStepper,null),/*#__PURE__*/React.createElement(NumberDecrementStepper,null))),/*#__PURE__*/React.createElement(FormHelperText,null,\"The amount of time the message can be accessed\"))),/*#__PURE__*/React.createElement(Box,{mt:4},/*#__PURE__*/React.createElement(UploadBox,{name:\"files\",setFieldValue:setFieldValue,values:values,encryptionKey:genKey}),cliplink&&/*#__PURE__*/React.createElement(ClipInput,{value:cliplink}),/*#__PURE__*/React.createElement(Flex,{justifyContent:\"center\"},/*#__PURE__*/React.createElement(Button,{size:\"lg\",colorScheme:\"blue\",mr:3,type:\"submit\",isLoading:isSubmitting},\"Encrypt\"))));}):/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h1\",null,\" Enter Token \"),/*#__PURE__*/React.createElement(Textarea,{placeholder:\"Enter Token\",onChange:handleChangeToken},\" \"),/*#__PURE__*/React.createElement(\"br\",null),/*#__PURE__*/React.createElement(Button,{size:\"lg\",colorScheme:\"blue\",mr:3,onClick:setAuthToken},\"Login\")));};export default SecureSharePage;// {JSON.stringify(values)}\n// {`start : ${range[0]?.startDate?.toISOString()}`}\n// {`end : ${range[0]?.endDate?.toISOString()}`}","map":{"version":3,"sources":["/home/dh/Desktop/react-chrome-secureshare/src/pages/SecureSharePage.jsx"],"names":["React","useState","useEffect","Textarea","Flex","NumberInput","NumberInputField","NumberInputStepper","NumberIncrementStepper","NumberDecrementStepper","useBreakpointValue","Stack","Text","useDisclosure","Popover","PopoverTrigger","PopoverContent","PopoverHeader","PopoverBody","PopoverArrow","PopoverCloseButton","PopoverFooter","Button","useToast","Box","Heading","FormControl","FormLabel","FormHelperText","Formik","Form","CryptoJS","gql","useMutation","nanoid","endOfDay","startOfDay","subDays","format","DateRangePicker","DateRange","ClipInput","UploadFile","useAuth","UploadBox","request","createShareMut","SecureSharePage","user","cliplink","setCliplink","baseDate","Date","toast","startDate","endDate","key","range","setRange","popM","_token","handleChangeToken","event","console","log","target","value","setAuthToken","localStorage","setItem","window","location","reload","popsize","base","lg","displayMobile","displayDesktop","genKey","setgenKey","createShareMutation","input","data","files","clickAllowed","values","resetForm","encrypted","AES","encrypt","toString","filen","map","v","name","mutateAsync","accountId","toISOString","username","encryptedData","fileNames","fileToUpload","secureshare_SecureShare_Create","Promise","all","f","val","filter","url","host","uuid","title","description","status","duration","isClosable","position","response","errors","message","isSubmitting","setFieldValue","handleChange","width","md","isOpen","onClose","onOpen","item","selection","s","n"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport {\n  Textarea,\n  Flex,\n  NumberInput,\n  NumberInputField,\n  NumberInputStepper,\n  NumberIncrementStepper,\n  NumberDecrementStepper,\n  useBreakpointValue,\n  Stack,\n  Text,\n  useDisclosure,\n  Popover,\n  PopoverTrigger,\n  PopoverContent,\n  PopoverHeader,\n  PopoverBody,\n  PopoverArrow,\n  PopoverCloseButton,\n  PopoverFooter,\n  Button,\n  useToast,\n  Box,\n  Heading,\n  FormControl,\n  FormLabel,\n  FormHelperText,\n} from '@chakra-ui/react';\nimport { Formik, Form } from 'formik';\nimport CryptoJS from 'crypto-js';\nimport { gql } from 'graphql-request';\nimport { useMutation } from 'react-query';\n\nimport { nanoid } from 'nanoid';\nimport { endOfDay, startOfDay, subDays, format } from 'date-fns';\n// import { format as zonedFormat, utcToZonedTime } from 'date-fns-tz';\nimport { DateRangePicker, DateRange } from 'react-date-range';\nimport ClipInput from '../components/ClipInput';\nimport UploadFile from '../api/uploadfile';\nimport { useAuth } from '../components/auth';\nimport UploadBox from '../components/UploadBox';\nimport { request } from '../api/graphql_api';\n\nconst createShareMut = gql`\n  mutation MyMutation(\n    $accountId: String = \"\"\n    $clickAllowed: Int = 10\n    $endDate: String = \"\"\n    $fileNames: [String]!\n    $startDate: String = \"\"\n    $encryptedData: String = \"\"\n    $username: String = \"\"\n  ) {\n    v1_secureshare_SecureShare_Create(\n      input: {\n        accountId: $accountId\n        clickAllowed: $clickAllowed\n        endDate: $endDate\n        fileNames: $fileNames\n        startDate: $startDate\n        encryptedData: $encryptedData\n        username: $username\n      }\n    ) {\n      files {\n        name\n        url\n      }\n      uuid\n    }\n  }\n`;\n\nconst SecureSharePage = () => {\n  const { user } = useAuth();\n\n\n  const [cliplink, setCliplink] = useState('');\n\n  const baseDate = new Date();\n  const toast = useToast();\n  const [range, setRange] = useState([\n    {\n      startDate: startOfDay(subDays(baseDate, 15)),\n      endDate: endOfDay(baseDate),\n      key: 'selection',\n    },\n  ]);\n  const popM = useDisclosure();\n  let _token = '';\n\n  function handleChangeToken(event) {\n    console.log(event.target.value);\n    _token = event.target.value\n  }\n\n  function setAuthToken(){\n    localStorage.setItem('access-token',_token)\n    window.location.reload();\n  }\n\n  const popsize = useBreakpointValue({ base: null, lg: 'auto' });\n\n  const displayMobile = useBreakpointValue({ base: true, lg: false });\n  const displayDesktop = useBreakpointValue({ base: false, lg: true });\n\n  // const formatedData = graphData?.map((v) => {\n  //   const datez = new Date(v.time);\n  //   const timeZone = 'Europe/Berlin';\n  //   const zonedDate = utcToZonedTime(datez, timeZone);\n  //   return {\n  //     count: v.count,\n  //     time: zonedFormat(zonedDate, 'MM/dd/yyyy', {\n  //       timeZone: 'UTC',\n  //     }),\n  //   };\n  // });\n\n  const [genKey, setgenKey] = useState('');\n\n  useEffect(() => {\n    setgenKey(nanoid());\n    return () => {};\n  }, []);\n\n  const createShareMutation = useMutation((input) =>\n    request(createShareMut, input),\n  );\n\n  return (\n    <Box flex={1}>\n      <Box mb={10}>\n        <Heading color=\"green.800\">SecureShare</Heading>\n        <Text color=\"gray.700\">Share your data securely</Text>\n      </Box>\n\n      {\n      user ? <Formik\n        enableReinitialize\n        initialValues={{\n          data: '',\n          files: [],\n          clickAllowed: 12,\n        }}\n        onSubmit={async (values, { resetForm }) => {\n          try {\n            const encrypted = CryptoJS.AES.encrypt(\n              values.data,\n              genKey,\n            ).toString();\n\n            const filen = values.files.map((v) => v.name);\n\n            const data = await createShareMutation.mutateAsync({\n              accountId: user.accountId,\n              clickAllowed: values.clickAllowed,\n              endDate: range[0]?.endDate?.toISOString(),\n              startDate: range[0]?.startDate?.toISOString(),\n              username: user.username,\n              encryptedData: encrypted,\n              fileNames: filen,\n            });\n\n            const fileToUpload = data?.secureshare_SecureShare_Create?.files;\n\n            if (fileToUpload) {\n              await Promise.all(\n                fileToUpload.map(async (f) => {\n                  const val = values.files.filter((v) => f.name === v.name);\n\n                  await UploadFile(f.url, val[0], null);\n                }),\n              );\n            }\n\n            setCliplink(\n              `http://${window?.location?.host}/app/secure/${data?.secureshare_SecureShare_Create?.uuid}/${genKey}`,\n            );\n\n            toast({\n              title: 'File encrypted',\n              description: 'Files Added',\n              status: 'success',\n              duration: 3000,\n              isClosable: true,\n              position: 'top',\n            });\n          } catch (e) {\n            if (e.response) {\n              toast({\n                title: 'Response Error',\n                description: e?.response?.errors[0]?.message,\n                status: 'error',\n                duration: 4000,\n                isClosable: true,\n                position: 'top',\n              });\n\n              return;\n            }\n\n            toast({\n              title: 'Application Error',\n              description: e.message,\n              status: 'error',\n              duration: 4000,\n              isClosable: true,\n              position: 'top',\n            });\n          }\n        }}>\n        {({ values, isSubmitting, setFieldValue, handleChange }) => (\n          <Form style={{ width: '100%' }}>\n            <Heading size=\"md\" mb={4}>\n              Encrypt a message\n            </Heading>\n            <Textarea\n              required\n              name=\"data\"\n              value={values.data}\n              placeholder=\"Place a message to encrypt here\"\n              onChange={handleChange}\n            />\n\n            <Stack\n              mt={4}\n              flexDirection={{ base: 'column', md: 'row' }}\n              justifyContent=\"space-between\"\n            >\n              <FormControl maxWidth={300}>\n                <FormLabel>Select Access Date Range</FormLabel>\n                <Stack spacing={2}>\n                  <Popover\n                    matchWidth\n                    placement=\"bottom-end\"\n                    isOpen={popM.isOpen}\n                    onClose={popM.onClose}\n                  >\n                    <PopoverTrigger>\n                      <Flex\n                        flexDirection={{ base: 'row', lg: 'row' }}\n                        tabIndex=\"0\"\n                        role=\"button\"\n                        aria-label=\"Date Range\"\n                        p={2}\n                        borderWidth={2}\n                        borderRadius=\"lg\"\n                        onClick={popM.onOpen}\n                        variant=\"outline\"\n                      >\n                        <Text mr={2} color=\"green.800\" fontWeight=\"bold\">\n                          {format(range[0].startDate, 'MM/dd/yyyy')}\n                        </Text>\n                        <Text mr={2}>to</Text>\n                        <Text color=\"green.800\" fontWeight=\"bold\">\n                          {format(range[0].endDate, 'MM/dd/yyyy')}\n                        </Text>\n                      </Flex>\n                    </PopoverTrigger>\n                    <PopoverContent width={popsize}>\n                      <PopoverArrow />\n                      <PopoverCloseButton />\n                      <PopoverHeader>Date Range</PopoverHeader>\n                      <PopoverBody>\n                        {displayMobile && (\n                          <DateRange\n                            editableDateInputs\n                            onChange={(item) => {\n                              item.selection.startDate = startOfDay(\n                                item.selection.startDate,\n                              );\n\n                              item.selection.endDate = endOfDay(\n                                item.selection.endDate,\n                              );\n\n                              setRange([item.selection]);\n                            }}\n                            moveRangeOnFirstSelection={false}\n                            ranges={range}\n                          />\n                        )}\n                        {displayDesktop && (\n                          <DateRangePicker\n                            editableDateInputs\n                            onChange={(item) => {\n                              item.selection.startDate = startOfDay(\n                                item.selection.startDate,\n                              );\n\n                              item.selection.endDate = endOfDay(\n                                item.selection.endDate,\n                              );\n\n                              setRange([item.selection]);\n                            }}\n                            showSelectionPreview\n                            moveRangeOnFirstSelection={false}\n                            months={1}\n                            ranges={range}\n                            direction=\"horizontal\"\n                          />\n                        )}\n                      </PopoverBody>\n                      <PopoverFooter d=\"flex\" justifyContent=\"flex-end\">\n                        <Button\n                          colorScheme=\"blue\"\n                          onClick={() => {\n                            popM.onClose();\n                            // analytics.refetch();\n                          }}\n                        >\n                          Apply\n                        </Button>\n                      </PopoverFooter>\n                    </PopoverContent>\n                  </Popover>\n                </Stack>\n                <FormHelperText>\n                  Choose when you want message to be accessed\n                </FormHelperText>\n              </FormControl>\n\n              <FormControl maxWidth={300} ml=\"auto\">\n                <FormLabel htmlFor=\"email\">Allowed Opens</FormLabel>\n                <NumberInput\n                  min={1}\n                  required\n                  onChange={(s, n) => {\n                    setFieldValue('clickAllowed', n);\n                  }}\n                  value={values.clickAllowed}\n                >\n                  <NumberInputField />\n                  <NumberInputStepper>\n                    <NumberIncrementStepper />\n                    <NumberDecrementStepper />\n                  </NumberInputStepper>\n                </NumberInput>\n                <FormHelperText>\n                  The amount of time the message can be accessed\n                </FormHelperText>\n              </FormControl>\n            </Stack>\n\n            <Box mt={4}>\n              <UploadBox\n                name=\"files\"\n                setFieldValue={setFieldValue}\n                values={values}\n                encryptionKey={genKey}\n              />\n\n              {cliplink && <ClipInput value={cliplink} />}\n\n              <Flex justifyContent=\"center\">\n                <Button\n                  size=\"lg\"\n                  colorScheme=\"blue\"\n                  mr={3}\n                  type=\"submit\"\n                  isLoading={isSubmitting}\n                >\n                  Encrypt\n                </Button>\n              </Flex>\n            </Box>\n          </Form>\n        )}\n      </Formik>\n      :\n      <div>\n      <h1> Enter Token </h1>\n\n      <Textarea\n        placeholder=\"Enter Token\"\n        onChange={handleChangeToken}> </Textarea>\n\n        <br/>  \n        <Button\n          size=\"lg\"\n          colorScheme=\"blue\"\n          mr={3}\n          onClick={setAuthToken}\n        >\n          Login\n        </Button>\n\n\n\n       </div>\n      }\n    </Box>\n  );\n};\n\nexport default SecureSharePage;\n\n// {JSON.stringify(values)}\n// {`start : ${range[0]?.startDate?.toISOString()}`}\n// {`end : ${range[0]?.endDate?.toISOString()}`}\n"]},"metadata":{},"sourceType":"module"}